<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è RICKROLL SHIELD PROblock BETA</title>
    <style>
        /* ========== STYLING - ALT INNENFOR ========== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 10px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            margin: 0 auto;
            border: 1px solid #00ff00;
            padding: 15px;
            overflow: hidden;
            word-wrap: break-word;
        }
        
        h1 {
            border-bottom: 2px solid #00ff00;
            padding-bottom: 10px;
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .mode-panel {
            border: 1px solid #00ff00;
            padding: 15px;
            margin: 15px 0;
        }
        
        .mode-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .mode-btn {
            background: #000;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 10px 15px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: clamp(12px, 3vw, 16px);
            flex: 1 1 auto;
            min-width: 80px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            pointer-events: auto;
            z-index: 10;
        }
        
        .mode-btn.active {
            background: #00ff00;
            color: #000;
            font-weight: bold;
        }
        
        .mode-description {
            margin-top: 10px;
            padding: 10px;
            background: #000;
            border-left: 3px solid #00ff00;
            word-wrap: break-word;
        }
        
        .tab-container {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            margin-bottom: -1px;
        }
        
        .tab {
            padding: 10px 15px;
            border: 1px solid #00ff00;
            background: #000;
            cursor: pointer;
            border-bottom: none;
            flex: 1 1 auto;
            text-align: center;
            min-width: 70px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: clamp(12px, 3vw, 14px);
            pointer-events: auto;
            z-index: 10;
        }
        
        .tab.active {
            background: #00ff00;
            color: #000;
        }
        
        .tab-content {
            border: 1px solid #00ff00;
            padding: 20px;
            background: #000;
            width: 100%;
            overflow-x: auto;
        }
        
        .input-area {
            margin: 20px 0;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: #000;
            color: #00ff00;
            border: 1px solid #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        textarea {
            height: 120px;
            resize: vertical;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
        }
        
        button {
            background: #000;
            color: #00ff00;
            border: 2px solid #00ff00;
            padding: 12px 20px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.2s;
            flex: 1 1 auto;
            min-width: 100px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            pointer-events: auto;
            z-index: 10;
        }
        
        button:hover {
            background: #00ff00;
            color: #000;
        }
        
        .result-box {
            border: 2px solid #00ff00;
            padding: 20px;
            margin: 20px 0;
            min-height: 120px;
            background: #000;
            width: 100%;
            overflow-x: auto;
            word-wrap: break-word;
        }
        
        .result-safe {
            border-color: #00ff00;
            background: #001100;
        }
        
        .result-danger {
            border-color: #ff0000;
            background: #110000;
            color: #ff6666;
        }
        
        .result-warning {
            border-color: #ffff00;
            background: #111100;
            color: #ffff00;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        
        .stat-box {
            border: 1px solid #00ff00;
            padding: 15px;
            text-align: center;
            background: #000;
            word-wrap: break-word;
        }
        
        .history-item {
            border: 1px solid #00ff00;
            padding: 10px;
            margin: 5px 0;
            background: #000;
            font-size: 14px;
            word-wrap: break-word;
        }
        
        .checkbox-group {
            margin: 10px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .checkbox-group label {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            border: 1px solid #00ff00;
            background: #000;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #00ff00;
            width: 0%;
            transition: width 0.3s;
        }
        
        .hidden {
            display: none;
        }
        
        .video-preview {
            border: 1px solid #00ff00;
            padding: 15px;
            margin: 15px 0;
            background: #000;
        }
        
        .video-thumbnail img {
            max-width: 100%;
            height: auto;
            border: 1px solid #00ff00;
        }
        
        .video-button {
            display: inline-block;
            margin-top: 10px;
            padding: 8px 16px;
            border: 1px solid #00ff00;
            color: #00ff00;
            text-decoration: none;
            background: #000;
            cursor: pointer;
        }
        
        .video-button:hover {
            background: #00ff00;
            color: #000;
        }
        
        footer {
            margin-top: 30px;
            padding-top: 10px;
            border-top: 1px solid #00ff00;
            text-align: center;
            font-size: 12px;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ°Ô∏è RICKROLL SHIELD PROblock BETA</h1>
        <p style="color: #666;">[SUPERAVANSERT] - QR-skanner, YouTube, enkelt API</p>
        
        <!-- MODE SELECTOR -->
        <div class="mode-panel">
            <div class="mode-buttons">
                <button class="mode-btn active" data-mode="basic">üî∞ BASIC</button>
                <button class="mode-btn" data-mode="advanced">‚ö° ADVANCED</button>
                <button class="mode-btn" data-mode="expert">üíÄ EXPERT</button>
                <button class="mode-btn" data-mode="ninja">ü•∑ NINJA</button>
                <button class="mode-btn" data-mode="quantum">‚öõÔ∏è QUANTUM</button>
            </div>
            
            <!-- TABS -->
            <div class="tab-container">
                <div class="tab active" data-tab="url">üîó URL</div>
                <div class="tab" data-tab="text">üìù TEXT</div>
                <div class="tab" data-tab="batch">üì¶ BATCH</div>
                <div class="tab" data-tab="qr">üì∑ QR</div>
                <div class="tab" data-tab="api">üåê API</div>
                <div class="tab" data-tab="settings">‚öôÔ∏è SETTINGS</div>
            </div>
        </div>
        
        <!-- URL TAB -->
        <div class="tab-content" id="tab-url">
            <div class="input-area">
                <input type="text" id="urlInput" placeholder="Lim inn URL eller YouTube-lenke...">
                
                <div class="button-group">
                    <button id="checkBtn">üîç SJEKK</button>
                    <button id="testBtn">üé≤ TEST</button>
                    <button id="clearBtn">üóëÔ∏è T√òM</button>
                    <button id="deepScanBtn">üî¨ DYP SCAN</button>
                </div>
                
                <div class="checkbox-group">
                    <label><input type="checkbox" id="followRedirects"> F√∏lg omdirigeringer</label>
                    <label><input type="checkbox" id="checkWayback"> Wayback Machine</label>
                </div>
            </div>
        </div>
        
        <!-- TEXT TAB -->
        <div class="tab-content hidden" id="tab-text">
            <div class="input-area">
                <textarea id="textInput" placeholder="Lim inn tekst som skal sjekkes..."></textarea>
                
                <select id="textMode">
                    <option value="smart">ü§ñ SMART DETEKSJON</option>
                    <option value="strict">üîí STRENGT MODUS</option>
                    <option value="relaxed">üòé AVSLAPPET</option>
                </select>
                
                <div class="button-group">
                    <button id="analyzeTextBtn">üìä ANALYSER TEKST</button>
                    <button id="extractUrlsBtn">üîó TREKK UT URLER</button>
                </div>
            </div>
        </div>
        
        <!-- BATCH TAB -->
        <div class="tab-content hidden" id="tab-batch">
            <div class="input-area">
                <textarea id="batchInput" placeholder="Lim inn flere URL-er (√©n per linje)..."></textarea>
                
                <div class="button-group">
                    <button id="batchCheckBtn">üìã SJEKK ALLE</button>
                    <button id="exportCsvBtn">üì§ EKSPORTER CSV</button>
                    <button id="importListBtn">üì• IMPORTER LISTE</button>
                </div>
                
                <div class="stats-grid" style="grid-template-columns: repeat(2,1fr);">
                    <div class="stat-box">TOTAL: <span id="batchTotal">0</span></div>
                    <div class="stat-box">RICKROLLS: <span id="batchRickrolls">0</span></div>
                </div>
                <div id="batchResults" style="margin-top:15px;"></div>
            </div>
        </div>
        
        <!-- QR TAB -->
        <div class="tab-content hidden" id="tab-qr">
            <div class="input-area">
                <h3>üì∑ QR-KODE SKANNER</h3>
                <p style="color:#666;">Skann QR-kode med kamera eller last opp bilde</p>
                
                <div class="button-group">
                    <button id="startCameraBtn">üì∏ START KAMERA</button>
                    <button id="uploadQrBtn">üìÅ LAST OPP BILDE</button>
                    <button id="stopCameraBtn" style="display:none;">‚èπÔ∏è STOPP KAMERA</button>
                </div>
                
                <div style="position: relative; margin: 15px 0; text-align: center;">
                    <video id="qrVideo" style="max-width: 100%; border: 2px solid #00ff00; display: none;" autoplay></video>
                    <canvas id="qrCanvas" style="display: none;"></canvas>
                </div>
                
                <img id="qrPreview" style="max-width: 100%; border: 2px solid #00ff00; margin-top: 15px; display: none;">
                
                <div id="qrResult" class="result-box" style="display: none;"></div>
            </div>
        </div>
        
        <!-- API TAB -->
        <div class="tab-content hidden" id="tab-api">
            <div class="input-area">
                <h3>üåê API-innstillinger (enkelt)</h3>
                <p style="color:#666;">Skru p√• for √• sjekke med eksterne tjenester</p>
                
                <div class="checkbox-group">
                    <label><input type="checkbox" id="useVirusTotal"> ü¶† VirusTotal</label>
                    <label><input type="checkbox" id="useGoogleSafe"> üõ°Ô∏è Google Safe Browsing</label>
                    <label><input type="checkbox" id="useIPQS"> üìä IPQualityScore</label>
                </div>
                
                <input type="text" id="apiKey" placeholder="Din API-n√∏kkel (valgfritt)">
                
                <div class="button-group">
                    <button id="testApiBtn">üß™ TEST API</button>
                    <button id="saveApiBtn">üíæ LAGRE</button>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="apiQuota" style="width: 0%;"></div>
                </div>
                <div id="apiStatus">Ingen API aktivert</div>
            </div>
        </div>
        
        <!-- SETTINGS TAB -->
        <div class="tab-content hidden" id="tab-settings">
            <div class="input-area">
                <h3>‚öôÔ∏è INNSTILLINGER</h3>
                
                <label>F√∏lsomhet:</label>
                <select id="sensitivity">
                    <option value="low">üîπ LAV</option>
                    <option value="medium" selected>üî∏ MEDIUM</option>
                    <option value="high">üî∫ H√òY</option>
                </select>
                
                <h3 style="margin-top:20px;">üìö EGNE M√òNSTRE</h3>
                <textarea id="dbEditor" rows="5" placeholder="Skriv inn m√∏nstre (√©n per linje)..."></textarea>
                
                <div class="button-group">
                    <button id="saveDbBtn">üíæ LAGRE</button>
                    <button id="resetDbBtn">üîÑ RESET</button>
                </div>
            </div>
        </div>
        
        <!-- RESULTATBOKS -->
        <div class="result-box" id="resultBox">
            <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                <span style="font-size: 24px;" id="resultIcon">‚ö°</span>
                <div style="flex:1;">
                    <div style="font-size: 18px;" id="resultTitle">Klar</div>
                    <div style="font-size: 12px; color:#666;" id="resultSubtitle"></div>
                </div>
            </div>
            <div id="youtubePreview" style="margin-top:15px;"></div>
            <div id="resultDetails" style="margin-top:15px;"></div>
            <div class="progress-bar" style="margin:10px 0;"><div class="progress-fill" id="confidenceBar" style="width:0%;"></div></div>
            <div style="display:flex; gap:15px; flex-wrap:wrap; font-size:12px; color:#666;">
                <span>Tillit: <span id="confidenceValue">0%</span></span>
                <span>Modus: <span id="resultMode">BASIC</span></span>
                <span>Tid: <span id="resultTime">-</span></span>
            </div>
        </div>
        
        <!-- STATISTIKK -->
        <div class="stats-grid">
            <div class="stat-box">TOTAL<br><span style="font-size:24px;" id="totalChecks">0</span></div>
            <div class="stat-box">RICKROLLS<br><span style="font-size:24px;" id="rickrollCount">0</span></div>
            <div class="stat-box">M√òNSTRE<br><span style="font-size:24px;" id="patternCount">0</span></div>
        </div>
        
        <!-- HISTORIKK -->
        <div style="margin:20px 0;">
            <h3>üìú HISTORIKK</h3>
            <div id="historyList"></div>
            <p id="emptyHistory" style="color:#666;">Ingen sjekker enda</p>
        </div>
        
        <!-- MODUSBESKRIVELSE -->
        <div class="mode-description" id="modeDesc">BASIC: Enkel scanning med lokal database</div>
        
        <footer>RICKROLL SHIELD PROblock BETA | QR-skanner | Enkelt API</footer>
    </div>

    <!-- QR-bibliotek -->
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    
    <script>
        // ============================================
        // RICKROLL SHIELD PROblock - FULLVERSJON
        // ============================================
        
        // ---------- DATABASE ----------
        const DEFAULT_DB = [
            'youtube.com/watch?v=dQw4w9WgXcQ',
            'youtu.be/dQw4w9WgXcQ',
            'youtube.com/shorts/dQw4w9WgXcQ',
            'rickroll.it',
            'rickastley.co.uk',
            'nevergonnagiveyouup.com',
            'bit.ly/3t0x1mz',
            'tinyurl.com/rickroll'
        ];
        
        // ---------- STATE ----------
        let database = [...DEFAULT_DB];
        let history = [];
        let totalChecks = 0;
        let rickrolls = 0;
        let currentMode = 'basic';
        let currentTab = 'url';
        
        // ---------- DOM-REFERANSER ----------
        const elements = {
            urlInput: document.getElementById('urlInput'),
            textInput: document.getElementById('textInput'),
            batchInput: document.getElementById('batchInput'),
            checkBtn: document.getElementById('checkBtn'),
            testBtn: document.getElementById('testBtn'),
            clearBtn: document.getElementById('clearBtn'),
            deepScanBtn: document.getElementById('deepScanBtn'),
            analyzeTextBtn: document.getElementById('analyzeTextBtn'),
            extractUrlsBtn: document.getElementById('extractUrlsBtn'),
            batchCheckBtn: document.getElementById('batchCheckBtn'),
            exportCsvBtn: document.getElementById('exportCsvBtn'),
            importListBtn: document.getElementById('importListBtn'),
            batchTotal: document.getElementById('batchTotal'),
            batchRickrolls: document.getElementById('batchRickrolls'),
            batchResults: document.getElementById('batchResults'),
            startCameraBtn: document.getElementById('startCameraBtn'),
            uploadQrBtn: document.getElementById('uploadQrBtn'),
            stopCameraBtn: document.getElementById('stopCameraBtn'),
            qrVideo: document.getElementById('qrVideo'),
            qrCanvas: document.getElementById('qrCanvas'),
            qrPreview: document.getElementById('qrPreview'),
            qrResult: document.getElementById('qrResult'),
            resultBox: document.getElementById('resultBox'),
            resultIcon: document.getElementById('resultIcon'),
            resultTitle: document.getElementById('resultTitle'),
            resultSubtitle: document.getElementById('resultSubtitle'),
            resultDetails: document.getElementById('resultDetails'),
            youtubePreview: document.getElementById('youtubePreview'),
            confidenceBar: document.getElementById('confidenceBar'),
            confidenceValue: document.getElementById('confidenceValue'),
            resultMode: document.getElementById('resultMode'),
            resultTime: document.getElementById('resultTime'),
            totalChecks: document.getElementById('totalChecks'),
            rickrollCount: document.getElementById('rickrollCount'),
            patternCount: document.getElementById('patternCount'),
            historyList: document.getElementById('historyList'),
            emptyHistory: document.getElementById('emptyHistory'),
            modeDesc: document.getElementById('modeDesc'),
            useVirusTotal: document.getElementById('useVirusTotal'),
            useGoogleSafe: document.getElementById('useGoogleSafe'),
            useIPQS: document.getElementById('useIPQS'),
            apiKey: document.getElementById('apiKey'),
            testApiBtn: document.getElementById('testApiBtn'),
            saveApiBtn: document.getElementById('saveApiBtn'),
            apiQuota: document.getElementById('apiQuota'),
            apiStatus: document.getElementById('apiStatus'),
            sensitivity: document.getElementById('sensitivity'),
            dbEditor: document.getElementById('dbEditor'),
            saveDbBtn: document.getElementById('saveDbBtn'),
            resetDbBtn: document.getElementById('resetDbBtn')
        };
        
        // ---------- GRUNNFUNKSJONER ----------
        
        function getVideoId(url) {
            if (url.includes('youtu.be/')) return url.split('youtu.be/')[1].split('?')[0];
            if (url.includes('v=')) return url.split('v=')[1].split('&')[0];
            if (url.includes('/shorts/')) return url.split('/shorts/')[1].split('?')[0];
            if (url.includes('/embed/')) return url.split('/embed/')[1].split('?')[0];
            return null;
        }
        
        async function scanYouTube(url) {
            const videoId = getVideoId(url);
            if (!videoId) return null;
            try {
                const resp = await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${videoId}&format=json`);
                if (!resp.ok) return null;
                const data = await resp.json();
                let conf = 0;
                let funn = [];
                if (videoId.toLowerCase() === 'dqw4w9wgxcq') { conf = 100; funn.push('ORIGINAL RICKROLL'); }
                if (data.title.toLowerCase().includes('rick')) { conf += 30; funn.push('Tittel inneholder "rick"'); }
                if (data.author_name.toLowerCase().includes('rick astley')) { conf += 50; funn.push('Kanal: Rick Astley'); }
                return {
                    title: data.title,
                    channel: data.author_name,
                    thumbnail: `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`,
                    videoId,
                    confidence: Math.min(conf, 100),
                    findings: funn,
                    url: `https://youtu.be/${videoId}`
                };
            } catch { return null; }
        }
        
        function checkUrl(input) {
            const url = input.toLowerCase();
            if (url.includes('dqw4w9wgxcq')) return { isRickroll: true, confidence: 100, reason: 'üé¨ Original Rickroll' };
            for (let p of database) if (url.includes(p.toLowerCase())) return { isRickroll: true, confidence: 95, reason: `‚ö†Ô∏è M√∏nster: ${p}` };
            return { isRickroll: false, confidence: 0, reason: '‚úÖ Trygg' };
        }
        
        function updateResult(icon, title, subtitle, details, conf) {
            elements.resultIcon.textContent = icon;
            elements.resultTitle.textContent = title;
            elements.resultSubtitle.textContent = subtitle;
            elements.resultDetails.innerHTML = details || '';
            elements.confidenceBar.style.width = conf + '%';
            elements.confidenceValue.textContent = conf + '%';
            elements.resultMode.textContent = currentMode.toUpperCase();
            elements.resultTime.textContent = new Date().toLocaleTimeString();
            if (conf >= 80) elements.resultBox.className = 'result-box result-danger';
            else if (conf >= 30) elements.resultBox.className = 'result-box result-warning';
            else elements.resultBox.className = 'result-box result-safe';
        }
        
        function addToHistory(item, result) {
            history.unshift({
                input: item.length>40? item.substring(0,37)+'...' : item,
                result: result.isRickroll ? 'üö® RICKROLL' : '‚úÖ SAFE',
                confidence: result.confidence || 0,
                time: new Date().toLocaleTimeString()
            });
            if (history.length > 20) history.pop();
            updateHistory();
            if (result.isRickroll) rickrolls++;
            totalChecks++;
            updateStats();
        }
        
        function updateHistory() {
            elements.historyList.innerHTML = '';
            if (history.length === 0) { elements.emptyHistory.style.display = 'block'; return; }
            elements.emptyHistory.style.display = 'none';
            history.forEach(h => {
                let div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `<span style="color:${h.result.includes('üö®')?'#ff6666':'#00ff00'}">${h.result}</span> [${h.confidence}%] ${h.time} - ${h.input}`;
                elements.historyList.appendChild(div);
            });
        }
        
        function updateStats() {
            elements.totalChecks.textContent = totalChecks;
            elements.rickrollCount.textContent = rickrolls;
            elements.patternCount.textContent = database.length;
        }
        
        function showYouTubePreview(data) {
            if (!data) { elements.youtubePreview.innerHTML = ''; return; }
            elements.youtubePreview.innerHTML = `
                <div style="border:1px solid #00ff00; padding:15px; margin-top:15px;">
                    <img src="${data.thumbnail}" style="max-width:100%; border:1px solid #00ff00;">
                    <div style="margin:10px 0;">${data.title}</div>
                    <div style="color:#666;">üì∫ ${data.channel}</div>
                    <a href="${data.url}" target="_blank" class="video-button">üé¨ SE VIDEO</a>
                </div>
            `;
        }
        
        // ---------- HOVEDFUNKSJONER ----------
        
        async function performCheck() {
            let input = elements.urlInput.value.trim();
            if (!input) return;
            elements.youtubePreview.innerHTML = '';
            updateResult('üîç', 'SCANNER...', '', '', 0);
            
            // Sjekk om YouTube
            if (input.includes('youtube.com') || input.includes('youtu.be')) {
                let yt = await scanYouTube(input);
                if (yt) {
                    let result = { isRickroll: yt.confidence >= 50, confidence: yt.confidence };
                    updateResult(result.isRickroll?'üö®':'‚úÖ', result.isRickroll?'RICKROLL FUNNET':'TRYGG', '', yt.findings.join('<br>'), yt.confidence);
                    showYouTubePreview(yt);
                    addToHistory('YouTube: '+input.substring(0,30), result);
                    return;
                }
            }
            
            // Vanlig URL-sjekk
            let result = checkUrl(input);
            updateResult(result.isRickroll?'üö®':'‚úÖ', result.isRickroll?'RICKROLL FUNNET':'TRYGG', result.reason, '', result.confidence);
            addToHistory(input, result);
        }
        
        function testRandom() {
            let tests = [
                'https://youtu.be/dQw4w9WgXcQ',
                'https://youtube.com/shorts/dQw4w9WgXcQ',
                'https://rickroll.it',
                'https://bit.ly/3t0x1mz',
                'https://safeside.com'
            ];
            elements.urlInput.value = tests[Math.floor(Math.random()*tests.length)];
            performCheck();
        }
        
        function analyzeText() {
            let text = elements.textInput.value.trim();
            if (!text) return;
            let lower = text.toLowerCase();
            let funn = [];
            let keywords = ['rick astley','rickroll','never gonna','give you up','dqw4w9wgxcq'];
            keywords.forEach(k => { if (lower.includes(k)) funn.push(`üéµ Fant "${k}"`); });
            if (funn.length === 0) updateResult('‚úÖ', 'INGEN FUNN', 'Teksten ser trygg ut', '', 0);
            else updateResult('‚ö†Ô∏è', 'MISTENKELIG', `Fant ${funn.length} treff`, funn.join('<br>'), 70);
        }
        
        function extractUrls() {
            let text = elements.textInput.value.trim();
            if (!text) return;
            let urls = text.match(/https?:\/\/[^\s]+/gi) || [];
            if (urls.length === 0) updateResult('üîó', 'INGEN URLER', 'Ingen nettadresser funnet', '', 0);
            else {
                let list = urls.map(u => `‚Ä¢ <a href="${u}" target="_blank" style="color:#00ff00;">${u.substring(0,50)}...</a>`).join('<br>');
                updateResult('üîó', `${urls.length} URLER FUNNET`, '', list, 0);
            }
        }
        
        function batchCheck() {
            let text = elements.batchInput.value.trim();
            if (!text) return;
            let lines = text.split('\n').filter(l=>l.trim());
            let rickCount = 0;
            let results = [];
            lines.forEach(line => {
                let r = checkUrl(line);
                if (r.isRickroll) rickCount++;
                results.push({ url: line.substring(0,30)+'...', isRickroll: r.isRickroll, conf: r.confidence });
            });
            elements.batchTotal.textContent = lines.length;
            elements.batchRickrolls.textContent = rickCount;
            let html = '<h4>Resultater:</h4>';
            results.forEach(r => {
                html += `<div style="border-bottom:1px solid #333; padding:5px;">
                    <span style="color:${r.isRickroll?'#ff6666':'#00ff00'}">${r.isRickroll?'üö®':'‚úÖ'}</span> ${r.url} [${r.conf}%]
                </div>`;
            });
            elements.batchResults.innerHTML = html;
        }
        
        function exportCsv() {
            let text = elements.batchInput.value.trim();
            if (!text) return;
            let lines = text.split('\n').filter(l=>l.trim());
            let csv = 'URL,Status,Confidence\n';
            lines.forEach(line => {
                let r = checkUrl(line);
                csv += `"${line.replace(/"/g,'""')}",${r.isRickroll?'RICKROLL':'SAFE'},${r.confidence}\n`;
            });
            let blob = new Blob([csv], {type:'text/csv'});
            let a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'rickroll-scan.csv';
            a.click();
        }
        
        function importList() {
            let input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt,.csv';
            input.onchange = (e) => {
                let file = e.target.files[0];
                if (!file) return;
                let reader = new FileReader();
                reader.onload = (ev) => { elements.batchInput.value = ev.target.result; };
                reader.readAsText(file);
            };
            input.click();
        }
        
        // ---------- QR-KODE ----------
        let qrScanning = false;
        let qrStream = null;
        
        elements.startCameraBtn.addEventListener('click', async () => {
            try {
                qrStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                elements.qrVideo.srcObject = qrStream;
                elements.qrVideo.style.display = 'block';
                elements.stopCameraBtn.style.display = 'inline-block';
                elements.startCameraBtn.style.display = 'none';
                qrScanning = true;
                requestAnimationFrame(scanQR);
            } catch (err) {
                alert('Kunne ikke starte kamera: ' + err.message);
            }
        });
        
        elements.stopCameraBtn.addEventListener('click', () => {
            if (qrStream) {
                qrStream.getTracks().forEach(t => t.stop());
                qrStream = null;
            }
            elements.qrVideo.style.display = 'none';
            elements.stopCameraBtn.style.display = 'none';
            elements.startCameraBtn.style.display = 'inline-block';
            qrScanning = false;
        });
        
        function scanQR() {
            if (!qrScanning) return;
            if (elements.qrVideo.readyState === elements.qrVideo.HAVE_ENOUGH_DATA) {
                let canvas = elements.qrCanvas;
                let ctx = canvas.getContext('2d');
                canvas.width = elements.qrVideo.videoWidth;
                canvas.height = elements.qrVideo.videoHeight;
                ctx.drawImage(elements.qrVideo, 0, 0, canvas.width, canvas.height);
                let imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                let code = jsQR(imgData.data, canvas.width, canvas.height);
                if (code) {
                    qrScanning = false;
                    if (qrStream) qrStream.getTracks().forEach(t => t.stop());
                    elements.qrVideo.style.display = 'none';
                    elements.stopCameraBtn.style.display = 'none';
                    elements.startCameraBtn.style.display = 'inline-block';
                    
                    elements.qrResult.style.display = 'block';
                    let result = checkUrl(code.data);
                    let cls = result.isRickroll ? 'result-danger' : 'result-safe';
                    elements.qrResult.className = `result-box ${cls}`;
                    elements.qrResult.innerHTML = `
                        <div style="font-size:18px;">${result.isRickroll ? 'üö® RICKROLL' : '‚úÖ TRYGG'}</div>
                        <div style="word-wrap:break-word; margin-top:10px;">${code.data}</div>
                        <div style="margin-top:10px;">Tillit: ${result.confidence}%</div>
                    `;
                    addToHistory('QR: '+code.data.substring(0,30), result);
                    return;
                }
            }
            requestAnimationFrame(scanQR);
        }
        
        elements.uploadQrBtn.addEventListener('click', () => {
            let input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = (e) => {
                let file = e.target.files[0];
                if (!file) return;
                let reader = new FileReader();
                reader.onload = (ev) => {
                    let img = new Image();
                    img.onload = () => {
                        let canvas = elements.qrCanvas;
                        let ctx = canvas.getContext('2d');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0, img.width, img.height);
                        let imgData = ctx.getImageData(0, 0, img.width, img.height);
                        let code = jsQR(imgData.data, img.width, img.height);
                        if (code) {
                            elements.qrPreview.src = ev.target.result;
                            elements.qrPreview.style.display = 'block';
                            elements.qrResult.style.display = 'block';
                            let result = checkUrl(code.data);
                            let cls = result.isRickroll ? 'result-danger' : 'result-safe';
                            elements.qrResult.className = `result-box ${cls}`;
                            elements.qrResult.innerHTML = `
                                <div style="font-size:18px;">${result.isRickroll ? 'üö® RICKROLL' : '‚úÖ TRYGG'}</div>
                                <div style="word-wrap:break-word; margin-top:10px;">${code.data}</div>
                                <div style="margin-top:10px;">Tillit: ${result.confidence}%</div>
                            `;
                            addToHistory('QR-bilde: '+code.data.substring(0,30), result);
                        } else {
                            alert('Ingen QR-kode funnet i bildet.');
                        }
                    };
                    img.src = ev.target.result;
                };
                reader.readAsDataURL(file);
            };
            input.click();
        });
        
        // ---------- API (forenklet, bare demo) ----------
        elements.testApiBtn.addEventListener('click', () => {
            let msg = [];
            if (elements.useVirusTotal.checked) msg.push('VirusTotal');
            if (elements.useGoogleSafe.checked) msg.push('Google Safe');
            if (elements.useIPQS.checked) msg.push('IPQualityScore');
            if (msg.length === 0) elements.apiStatus.textContent = 'Ingen API valgt';
            else elements.apiStatus.textContent = 'API test OK: ' + msg.join(', ');
            elements.apiQuota.style.width = '30%';
        });
        
        elements.saveApiBtn.addEventListener('click', () => {
            localStorage.setItem('apiKey', elements.apiKey.value);
            alert('API-n√∏kkel lagret (i nettleseren)');
        });
        
        // ---------- SETTINGS ----------
        elements.saveDbBtn.addEventListener('click', () => {
            let lines = elements.dbEditor.value.split('\n').filter(l=>l.trim());
            if (lines.length) {
                database = [...new Set([...database, ...lines])];
                updateStats();
                updateResult('üíæ', 'DATABASE OPPDATERT', `${database.length} m√∏nstre totalt`, '', 0);
            }
        });
        
        elements.resetDbBtn.addEventListener('click', () => {
            if (confirm('Tilbakestill til standard database?')) {
                database = [...DEFAULT_DB];
                elements.dbEditor.value = database.join('\n');
                updateStats();
                updateResult('üîÑ', 'DATABASE RESET', 'Standardm√∏nstre lastet', '', 0);
            }
        });
        
        // ---------- EVENT LISTENERS ----------
        elements.checkBtn.addEventListener('click', performCheck);
        elements.testBtn.addEventListener('click', testRandom);
        elements.clearBtn.addEventListener('click', () => { history = []; updateHistory(); updateResult('üóëÔ∏è', 'HISTORIKK T√òMT', '', '', 0); });
        elements.deepScanBtn.addEventListener('click', () => { performCheck(); /* kan utvides */ });
        elements.analyzeTextBtn.addEventListener('click', analyzeText);
        elements.extractUrlsBtn.addEventListener('click', extractUrls);
        elements.batchCheckBtn.addEventListener('click', batchCheck);
        elements.exportCsvBtn.addEventListener('click', exportCsv);
        elements.importListBtn.addEventListener('click', importList);
        
        // Mode selector
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentMode = btn.dataset.mode;
                elements.modeDesc.textContent = currentMode.toUpperCase() + ' modus aktivert';
            });
        });
        
        // Tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentTab = tab.dataset.tab;
                document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                document.getElementById('tab-'+currentTab).classList.remove('hidden');
            });
        });
        
        // Enter-tast i url-felt
        elements.urlInput.addEventListener('keypress', e => { if (e.key === 'Enter') performCheck(); });
        
        // Initialiser
        elements.patternCount.textContent = database.length;
        elements.dbEditor.value = database.join('\n');
        updateResult('‚ö°', 'KLAR', 'Velg en modus og skann', '', 0);
        
        // Last eventuell lagret API-n√∏kkel
        let savedKey = localStorage.getItem('apiKey');
        if (savedKey) elements.apiKey.value = savedKey;
    </script>
</body>
</html>
