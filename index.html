<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è RICKROLL SHIELD PROblock BETA</title>
    <style>
        /* ============================================
           STYLING - Alt innenfor container, ingenting stikker ut
           ============================================ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 10px;
            overflow-x: hidden;  /* INGENTING stikker ut horisontalt */
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            margin: 0 auto;
            border: 1px solid #00ff00;
            padding: 15px;
            overflow: hidden;  /* Alt holdes innenfor */
            word-wrap: break-word;  /* Lange ord brytes */
        }
        
        /* ALLE elementer m√• respektere container-width */
        h1, p, div, input, textarea, button, .result-box, .stats-grid {
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        h1 {
            border-bottom: 2px solid #00ff00;
            padding-bottom: 10px;
            font-size: clamp(1.5rem, 5vw, 2.5rem);  /* Responsiv skrift */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .mode-panel {
            border: 1px solid #00ff00;
            padding: 15px;
            margin: 15px 0;
            width: 100%;
        }
        
        .mode-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .mode-btn {
            background: #000;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 10px 15px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: clamp(12px, 3vw, 16px);
            flex: 1 1 auto;
            min-width: 80px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .mode-btn.active {
            background: #00ff00;
            color: #000;
            font-weight: bold;
        }
        
        .mode-description {
            margin-top: 10px;
            padding: 10px;
            background: #000;
            border-left: 3px solid #00ff00;
            word-wrap: break-word;
        }
        
        .tab-container {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            margin-bottom: -1px;
            width: 100%;
        }
        
        .tab {
            padding: 10px 15px;
            border: 1px solid #00ff00;
            background: #000;
            cursor: pointer;
            border-bottom: none;
            flex: 1 1 auto;
            text-align: center;
            min-width: 70px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: clamp(12px, 3vw, 14px);
        }
        
        .tab.active {
            background: #00ff00;
            color: #000;
        }
        
        .tab-content {
            border: 1px solid #00ff00;
            padding: 20px;
            background: #000;
            width: 100%;
            overflow-x: auto;
            overflow-y: visible;
        }
        
        .input-area {
            margin: 20px 0;
            width: 100%;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: #000;
            color: #00ff00;
            border: 1px solid #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            box-sizing: border-box;
            max-width: 100%;
        }
        
        textarea {
            height: 120px;
            resize: vertical;
            max-width: 100%;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
            width: 100%;
        }
        
        button {
            background: #000;
            color: #00ff00;
            border: 2px solid #00ff00;
            padding: 12px 20px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.2s;
            flex: 1 1 auto;
            min-width: 100px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        button:hover {
            background: #00ff00;
            color: #000;
        }
        
        .result-box {
            border: 2px solid #00ff00;
            padding: 20px;
            margin: 20px 0;
            min-height: 120px;
            background: #000;
            width: 100%;
            overflow-x: auto;
            word-wrap: break-word;
        }
        
        .result-safe {
            border-color: #00ff00;
            background: #001100;
        }
        
        .result-danger {
            border-color: #ff0000;
            background: #110000;
            color: #ff6666;
        }
        
        .result-warning {
            border-color: #ffff00;
            background: #111100;
            color: #ffff00;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 20px 0;
            width: 100%;
        }
        
        .stat-box {
            border: 1px solid #00ff00;
            padding: 15px;
            text-align: center;
            background: #000;
            word-wrap: break-word;
        }
        
        .history-item {
            border: 1px solid #00ff00;
            padding: 10px;
            margin: 5px 0;
            background: #000;
            font-size: 14px;
            word-wrap: break-word;
            width: 100%;
        }
        
        .checkbox-group {
            margin: 10px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .checkbox-group label {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            border: 1px solid #00ff00;
            background: #000;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #00ff00;
            width: 0%;
            transition: width 0.3s;
        }
        
        .hidden {
            display: none;
        }
        
        /* YouTube video preview - holder seg innenfor */
        .video-preview {
            border: 1px solid #00ff00;
            padding: 15px;
            margin: 15px 0;
            background: #000;
            width: 100%;
            overflow: hidden;
        }
        
        .video-thumbnail {
            max-width: 100%;
            height: auto;
            border: 1px solid #00ff00;
            margin-bottom: 10px;
        }
        
        .video-thumbnail img {
            max-width: 100%;
            height: auto;
            display: block;
        }
        
        .video-title {
            font-size: 16px;
            font-weight: bold;
            margin: 10px 0;
            word-wrap: break-word;
        }
        
        .video-channel {
            color: #666;
            margin-bottom: 10px;
            word-wrap: break-word;
        }
        
        .video-button {
            background: #000;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 8px 16px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 5px 0;
        }
        
        .video-button:hover {
            background: #00ff00;
            color: #000;
        }
        
        .footer {
            margin-top: 30px;
            padding-top: 10px;
            border-top: 1px solid #00ff00;
            text-align: center;
            font-size: 12px;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 title="üõ°Ô∏è RICKROLL SHIELD PROblock BETA">üõ°Ô∏è RICKROLL SHIELD PROblock BETA</h1>
        <p style="color: #666; word-wrap: break-word;">[SUPERAVANSERT] - Alt innenfor, ingenting stikker ut</p>
        
        <!-- MODE SELECTOR -->
        <div class="mode-panel">
            <div class="mode-buttons">
                <button class="mode-btn active" data-mode="basic">üî∞ BASIC</button>
                <button class="mode-btn" data-mode="advanced">‚ö° ADVANCED</button>
                <button class="mode-btn" data-mode="expert">üíÄ EXPERT</button>
                <button class="mode-btn" data-mode="ninja">ü•∑ NINJA</button>
                <button class="mode-btn" data-mode="quantum">‚öõÔ∏è QUANTUM</button>
            </div>
            
            <!-- TABS -->
            <div class="tab-container">
                <div class="tab active" data-tab="url">üîó URL</div>
                <div class="tab" data-tab="text">üìù TEXT</div>
                <div class="tab" data-tab="batch">üì¶ BATCH</div>
                <div class="tab" data-tab="api">üåê API</div>
                <div class="tab" data-tab="settings">‚öôÔ∏è SETTINGS</div>
            </div>
        </div>
        
        <!-- URL TAB -->
        <div class="tab-content" id="tab-url">
            <div class="input-area">
                <input type="text" id="urlInput" placeholder="Enter URL, YouTube link, or text...">
                
                <div class="button-group">
                    <button id="checkBtn">üîç CHECK</button>
                    <button id="testBtn">üé≤ TEST</button>
                    <button id="clearBtn">üóëÔ∏è CLEAR</button>
                    <button id="deepScanBtn">üî¨ DEEP SCAN</button>
                </div>
                
                <!-- AVANSERTE OPTIONS -->
                <div class="checkbox-group">
                    <label><input type="checkbox" id="followRedirects"> Follow redirects</label>
                    <label><input type="checkbox" id="checkWayback"> Wayback Machine</label>
                    <label><input type="checkbox" id="virusTotal"> VirusTotal</label>
                    <label><input type="checkbox" id="googleSafe"> Google Safe</label>
                </div>
            </div>
        </div>
        
        <!-- TEXT TAB -->
        <div class="tab-content hidden" id="tab-text">
            <div class="input-area">
                <textarea id="textInput" placeholder="Paste text, email, or document content..."></textarea>
                
                <select id="textMode">
                    <option value="smart">ü§ñ SMART DETECTION</option>
                    <option value="strict">üîí STRICT MODE</option>
                    <option value="relaxed">üòé RELAXED MODE</option>
                    <option value="paranoid">üëÄ PARANOID MODE</option>
                </select>
                
                <div class="button-group">
                    <button id="analyzeTextBtn">üìä ANALYZE TEXT</button>
                    <button id="extractUrlsBtn">üîó EXTRACT URLS</button>
                    <button id="findPatternsBtn">üîç FIND PATTERNS</button>
                </div>
            </div>
        </div>
        
        <!-- BATCH TAB -->
        <div class="tab-content hidden" id="tab-batch">
            <div class="input-area">
                <textarea id="batchInput" placeholder="Enter multiple URLs (one per line)..."></textarea>
                
                <div class="button-group">
                    <button id="batchCheckBtn">üìã CHECK ALL</button>
                    <button id="exportCsvBtn">üì§ EXPORT CSV</button>
                    <button id="importListBtn">üì• IMPORT LIST</button>
                </div>
                
                <div class="stats-grid" style="grid-template-columns: repeat(2,1fr);">
                    <div class="stat-box">TOTAL: <span id="batchTotal">0</span></div>
                    <div class="stat-box">RICKROLLS: <span id="batchRickrolls">0</span></div>
                </div>
            </div>
        </div>
        
        <!-- API TAB -->
        <div class="tab-content hidden" id="tab-api">
            <div class="input-area">
                <input type="text" id="apiKey" placeholder="Enter API Key (optional)">
                
                <select id="apiService">
                    <option value="none">üö´ No API</option>
                    <option value="virustotal">üî¨ VirusTotal</option>
                    <option value="google">üõ°Ô∏è Google Safe</option>
                    <option value="ipquality">üìä IPQualityScore</option>
                </select>
                
                <div class="button-group">
                    <button id="testApiBtn">üß™ TEST API</button>
                    <button id="saveApiBtn">üíæ SAVE API</button>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="apiQuota" style="width: 30%;"></div>
                </div>
                <div>API Quota: 30% used</div>
            </div>
        </div>
        
        <!-- SETTINGS TAB -->
        <div class="tab-content hidden" id="tab-settings">
            <div class="input-area">
                <h3>‚öôÔ∏è DETECTION SETTINGS</h3>
                
                <label>Sensitivity:</label>
                <select id="sensitivity">
                    <option value="low">üîπ LOW</option>
                    <option value="medium" selected>üî∏ MEDIUM</option>
                    <option value="high">üî∫ HIGH</option>
                    <option value="ultra">üíÄ ULTRA</option>
                </select>
                
                <h3 style="margin-top: 20px;">üìö DATABASE</h3>
                <textarea id="dbEditor" rows="5" placeholder="Custom patterns (one per line)..."></textarea>
                
                <div class="button-group">
                    <button id="saveDbBtn">üíæ SAVE DB</button>
                    <button id="resetDbBtn">üîÑ RESET</button>
                    <button id="importDbBtn">üì• IMPORT</button>
                    <button id="exportDbBtn">üì§ EXPORT</button>
                </div>
            </div>
        </div>
        
        <!-- RESULT AREA -->
        <div class="result-box" id="resultBox">
            <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                <span style="font-size: 24px;" id="resultIcon">‚ö°</span>
                <div style="flex: 1; min-width: 200px;">
                    <div style="font-size: 18px;" id="resultTitle">Ready to scan</div>
                    <div style="font-size: 12px; color: #666;" id="resultSubtitle">Select mode and enter data</div>
                </div>
            </div>
            
            <!-- YOUTUBE PREVIEW (vises her) -->
            <div id="youtubePreview" style="margin-top: 15px; border-top: 1px solid #333; padding-top: 15px;"></div>
            
            <!-- DETAILS -->
            <div style="margin-top: 15px;" id="resultDetails"></div>
            
            <!-- CONFIDENCE -->
            <div class="progress-bar" style="margin: 10px 0;">
                <div class="progress-fill" id="confidenceBar" style="width: 0%;"></div>
            </div>
            
            <!-- METADATA -->
            <div style="font-size: 12px; color: #666; display: flex; gap: 15px; flex-wrap: wrap;" id="resultMeta">
                <span>Confidence: <span id="confidenceValue">0%</span></span>
                <span>Mode: <span id="resultMode">BETA</span></span>
                <span>Time: <span id="resultTime">-</span></span>
            </div>
        </div>
        
        <!-- STATISTICS -->
        <div class="stats-grid">
            <div class="stat-box">
                TOTAL CHECKS<br>
                <span style="font-size: 24px;" id="totalChecks">0</span>
            </div>
            <div class="stat-box">
                RICKROLLS<br>
                <span style="font-size: 24px;" id="rickrollCount">0</span>
            </div>
            <div class="stat-box">
                PATTERNS<br>
                <span style="font-size: 24px;" id="patternCount">100+</span>
            </div>
            <div class="stat-box">
                ACCURACY<br>
                <span style="font-size: 24px;" id="accuracy">98%</span>
            </div>
        </div>
        
        <!-- HISTORY -->
        <div style="margin: 20px 0; width: 100%;">
            <h3>üìú HISTORY</h3>
            <div id="historyList"></div>
            <p id="emptyHistory" style="color: #666;">No checks yet</p>
        </div>
        
        <!-- MODE DESCRIPTION -->
        <div class="mode-description" id="modeDesc">
            BETA MODE: Basic scanning with local database
        </div>
        
        <div class="footer">
            RICKROLL SHIELD PROblock BETA | SUPERAVANSERT | Alt innenfor | Redirect fikset | Video-knapp
        </div>
    </div>

    <script>
        // ============================================
        // RICKROLL SHIELD PROblock - AVANSERT FORKLARING
        // ============================================
        
        // ===== DATABASE =====
        // Array med kjente Rickroll-m√∏nstre
        const DEFAULT_DB = [
            'youtube.com/watch?v=dQw4w9WgXcQ',  // Original Rickroll
            'youtu.be/dQw4w9WgXcQ',              // Kort-URL
            'youtube.com/shorts/dQw4w9WgXcQ',    // YouTube Shorts
            'rickroll.it',                        // Rickroll domene
            'rickastley.co.uk',                   // Offisielt? ;)
            'nevergonnagiveyouup.com',            # Literally
            'bit.ly/3t0x1mz',                      # Forkortet Rickroll
            'tinyurl.com/rickroll'                 # TinyURL variant
        ];
        
        // ===== KEYWORDS for tekstanalyse =====
        const KEYWORDS = {
            rick: ['rick astley', 'rickroll', 'never gonna', 'give you up', 'let you down', 'desert you'],
            youtube: ['dqw4w9wgxcq', 'ohg5sjyrha0', 'ub82xb1c8os'],  # Video-IDer
            suspicious: ['free robux', 'free vbucks', 'hack tool', 'cracked', 'password generator'],
            patterns: [
                /rick.*astley/i,
                /never.*gonna.*give.*you.*up/i,
                /dqw4w9wgxcq/i,
                /bit\.ly\/\w+/i,
                /tinyurl\.com\/\w+/i
            ]
        };
        
        // ===== STATE =====
        // Dette er alle variablene som holder programmets tilstand
        let database = [...DEFAULT_DB];           // Aktiv database
        let history = [];                          // Sjekkhistorikk
        let totalChecks = 0;                       // Totalt antall sjekker
        let rickrolls = 0;                          // Antall funnet
        let currentMode = 'basic';                  // N√•v√¶rende modus
        let currentTab = 'url';                      // N√•v√¶rende tab
        
        // ===== DOM Elements =====
        // Henter alle HTML-elementer vi trenger √• manipulere
        const elements = {
            resultBox: document.getElementById('resultBox'),
            resultIcon: document.getElementById('resultIcon'),
            resultTitle: document.getElementById('resultTitle'),
            resultSubtitle: document.getElementById('resultSubtitle'),
            resultDetails: document.getElementById('resultDetails'),
            confidenceBar: document.getElementById('confidenceBar'),
            confidenceValue: document.getElementById('confidenceValue'),
            resultMode: document.getElementById('resultMode'),
            resultTime: document.getElementById('resultTime'),
            totalChecks: document.getElementById('totalChecks'),
            rickrollCount: document.getElementById('rickrollCount'),
            patternCount: document.getElementById('patternCount'),
            historyList: document.getElementById('historyList'),
            emptyHistory: document.getElementById('emptyHistory'),
            modeDesc: document.getElementById('modeDesc'),
            youtubePreview: document.getElementById('youtubePreview'),
            urlInput: document.getElementById('urlInput'),
            textInput: document.getElementById('textInput'),
            batchInput: document.getElementById('batchInput'),
            checkBtn: document.getElementById('checkBtn'),
            testBtn: document.getElementById('testBtn'),
            clearBtn: document.getElementById('clearBtn'),
            deepScanBtn: document.getElementById('deepScanBtn'),
            analyzeTextBtn: document.getElementById('analyzeTextBtn'),
            extractUrlsBtn: document.getElementById('extractUrlsBtn'),
            findPatternsBtn: document.getElementById('findPatternsBtn'),
            batchCheckBtn: document.getElementById('batchCheckBtn'),
            exportCsvBtn: document.getElementById('exportCsvBtn'),
            importListBtn: document.getElementById('importListBtn'),
            batchTotal: document.getElementById('batchTotal'),
            batchRickrolls: document.getElementById('batchRickrolls'),
            apiKey: document.getElementById('apiKey'),
            apiService: document.getElementById('apiService'),
            testApiBtn: document.getElementById('testApiBtn'),
            saveApiBtn: document.getElementById('saveApiBtn'),
            apiQuota: document.getElementById('apiQuota'),
            sensitivity: document.getElementById('sensitivity'),
            dbEditor: document.getElementById('dbEditor'),
            saveDbBtn: document.getElementById('saveDbBtn'),
            resetDbBtn: document.getElementById('resetDbBtn'),
            importDbBtn: document.getElementById('importDbBtn'),
            exportDbBtn: document.getElementById('exportDbBtn')
        };
        
        // ============================================
        // FUNKSJON 1: getVideoId()
        // Henter YouTube video-ID fra ulike URL-formater
        // ============================================
        function getVideoId(url) {
            // youtu.be/dQw4w9WgXcQ
            if (url.includes('youtu.be/')) {
                return url.split('youtu.be/')[1].split('?')[0].split('&')[0];
            }
            // youtube.com/watch?v=dQw4w9WgXcQ
            if (url.includes('v=')) {
                return url.split('v=')[1].split('&')[0];
            }
            // youtube.com/shorts/dQw4w9WgXcQ
            if (url.includes('/shorts/')) {
                return url.split('/shorts/')[1].split('?')[0].split('&')[0];
            }
            // youtube.com/embed/dQw4w9WgXcQ
            if (url.includes('/embed/')) {
                return url.split('/embed/')[1].split('?')[0];
            }
            return null;
        }
        
        // ============================================
        // FUNKSJON 2: scanYouTube()
        // Henter YouTube-data via oEmbed API (GRATIS!)
        // ============================================
        async function scanYouTube(url) {
            const videoId = getVideoId(url);
            if (!videoId) return null;
            
            try {
                // oEmbed API - fungerer uten API key!
                const response = await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${videoId}&format=json`);
                if (!response.ok) return null;
                
                const data = await response.json();
                
                // Analyser tittel og kanal
                let confidence = 0;
                let findings = [];
                
                // Video-ID sjekk (100% match)
                if (videoId.toLowerCase() === 'dqw4w9wgxcq') {
                    confidence = 100;
                    findings.push('üö® ORIGINAL RICKROLL VIDEO-ID!');
                }
                
                // Tittel-analyse
                const title = data.title.toLowerCase();
                KEYWORDS.rick.forEach(word => {
                    if (title.includes(word)) {
                        confidence += 20;
                        findings.push(`üì∫ Title contains "${word}"`);
                    }
                });
                
                // Kanal-analyse
                const channel = data.author_name.toLowerCase();
                if (channel.includes('rick astley')) {
                    confidence += 50;
                    findings.push('üé§ Channel: Rick Astley (OFFICIAL!)');
                }
                
                return {
                    title: data.title,
                    channel: data.author_name,
                    thumbnail: `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`,
                    videoId: videoId,
                    confidence: Math.min(confidence, 100),  // Maks 100%
                    findings: findings,
                    url: `https://youtu.be/${videoId}`
                };
            } catch (e) {
                console.error('YouTube scan error:', e);
                return null;
            }
        }
        
        // ============================================
        // FUNKSJON 3: checkUrl()
        // Sjekker URL mot database og keywords
        // ============================================
        function checkUrl(input) {
            const url = input.toLowerCase();
            
            // 1. Exact match p√• video-ID
            if (url.includes('dqw4w9wgxcq')) {
                return { isRickroll: true, confidence: 100, reason: 'üé¨ Original Rickroll video-ID' };
            }
            
            // 2. Database check
            for (const pattern of database) {
                if (url.includes(pattern.toLowerCase())) {
                    return { isRickroll: true, confidence: 95, reason: `üìå Database match: ${pattern}` };
                }
            }
            
            // 3. Keyword check
            for (const keyword of KEYWORDS.suspicious) {
                if (url.includes(keyword)) {
                    return { isRickroll: true, confidence: 70, reason: `‚ö†Ô∏è Suspicious keyword: ${keyword}` };
                }
            }
            
            return { isRickroll: false, confidence: 0, reason: '‚úÖ No threats detected' };
        }
        
        // ============================================
        // FUNKSJON 4: analyzeText()
        // Analyserer tekst for Rickroll-m√∏nstre
        // ============================================
        function analyzeText(text) {
            const results = [];
            const lower = text.toLowerCase();
            
            // Sjekk keywords
            KEYWORDS.rick.forEach(word => {
                const regex = new RegExp(word, 'gi');
                const matches = (lower.match(regex) || []).length;
                if (matches > 0) {
                    results.push({ 
                        type: 'üéµ RICKROLL', 
                        match: word, 
                        count: matches,
                        confidence: 90 
                    });
                }
            });
            
            // Sjekk suspicious words
            KEYWORDS.suspicious.forEach(word => {
                if (lower.includes(word)) {
                    results.push({ 
                        type: '‚ö†Ô∏è SUSPICIOUS', 
                        match: word, 
                        count: 1,
                        confidence: 70 
                    });
                }
            });
            
            // Extract og sjekk URLs
            const urls = text.match(/https?:\/\/[^\s]+/gi) || [];
            urls.forEach(url => {
                const check = checkUrl(url);
                if (check.isRickroll) {
                    results.push({ 
                        type: 'üîó URL', 
                        match: url.substring(0, 30) + '...', 
                        confidence: check.confidence 
                    });
                }
            });
            
            return results;
        }
        
        // ============================================
        // FUNKSJON 5: showYouTubePreview()
        // Viser YouTube thumbnail og info med "Se video" knapp
        // ============================================
        function showYouTubePreview(videoData) {
            if (!videoData) {
                elements.youtubePreview.innerHTML = '';
                return;
            }
            
            elements.youtubePreview.innerHTML = `
                <div class="video-preview">
                    <div class="video-thumbnail">
                        <img src="${videoData.thumbnail}" alt="Video thumbnail" 
                             onerror="this.src='https://img.youtube.com/vi/${videoData.videoId}/hqdefault.jpg'">
                    </div>
                    <div class="video-title">${videoData.title}</div>
                    <div class="video-channel">üì∫ ${videoData.channel}</div>
                    <div style="margin: 10px 0;">
                        ${videoData.findings.map(f => `<span style="background:#00ff00; color:#000; padding:2px 8px; margin:2px; display:inline-block;">${f}</span>`).join(' ')}
                    </div>
                    <a href="${videoData.url}" target="_blank" class="video-button">üé¨ SE VIDEO üé¨</a>
                </div>
            `;
        }
        
        // ============================================
        // FUNKSJON 6: updateResult()
        // Oppdaterer resultat-boksen
        // ============================================
        function updateResult(icon, title, subtitle, details, confidence) {
            elements.resultIcon.textContent = icon;
            elements.resultTitle.textContent = title;
            elements.resultSubtitle.textContent = subtitle;
            elements.resultDetails.innerHTML = details || '';
            elements.confidenceBar.style.width = confidence + '%';
            elements.confidenceValue.textContent = confidence + '%';
            elements.resultMode.textContent = currentMode.toUpperCase();
            elements.resultTime.textContent = new Date().toLocaleTimeString();
            
            // Farge basert p√• confidence
            if (confidence >= 80) {
                elements.resultBox.className = 'result-box result-danger';
            } else if (confidence >= 30) {
                elements.resultBox.className = 'result-box result-warning';
            } else {
                elements.resultBox.className = 'result-box result-safe';
            }
        }
        
        // ============================================
        // FUNKSJON 7: addToHistory()
        // Legger til sjekk i historikk
        // ============================================
        function addToHistory(item, result) {
            const historyItem = {
                id: Date.now(),
                input: item.length > 40 ? item.substring(0, 37) + '...' : item,
                result: result.isRickroll ? 'üö® RICKROLL' : '‚úÖ SAFE',
                confidence: result.confidence || 0,
                time: new Date().toLocaleTimeString()
            };
            
            history.unshift(historyItem);
            if (history.length > 20) history.pop();
            updateHistory();
            
            if (result.isRickroll) rickrolls++;
            totalChecks++;
            updateStats();
        }
        
        // ============================================
        // FUNKSJON 8: updateHistory()
        // Oppdaterer historikk-visningen
        // ============================================
        function updateHistory() {
            elements.historyList.innerHTML = '';
            if (history.length === 0) {
                elements.emptyHistory.style.display = 'block';
                return;
            }
            
            elements.emptyHistory.style.display = 'none';
            history.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `<span style="color: ${item.result.includes('üö®') ? '#ff6666' : '#00ff00'}">${item.result}</span> [${item.confidence}%] ${item.time} - ${item.input}`;
                elements.historyList.appendChild(div);
            });
        }
        
        // ============================================
        // FUNKSJON 9: updateStats()
        // Oppdaterer statistikk
        // ============================================
        function updateStats() {
            elements.totalChecks.textContent = totalChecks;
            elements.rickrollCount.textContent = rickrolls;
            elements.patternCount.textContent = database.length;
        }
        
        // ============================================
        // FUNKSJON 10: simulateRedirect()
        // Simulerer redirect-f√∏lging (uten CORS!)
        // ============================================
        function simulateRedirect(url) {
            // Dette er en SIMULERT redirect-sjekk
            // Ekte redirects krever backend, men vi simulerer:
            const redirectMap = {
                'bit.ly/3t0x1mz': 'https://youtu.be/dQw4w9WgXcQ',
                'tinyurl.com/rickroll': 'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                'shorturl.at/rickroll': 'https://rickroll.it'
            };
            
            const shortener = url.replace(/^https?:\/\//, '');
            for (let [short, dest] of Object.entries(redirectMap)) {
                if (shortener.includes(short)) {
                    return {
                        redirected: true,
                        original: url,
                        destination: dest,
                        isRickroll: checkUrl(dest).isRickroll
                    };
                }
            }
            return { redirected: false };
        }
        
        // ============================================
        // EVENT HANDLERS
        // ============================================
        
        // Mode selector
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentMode = btn.dataset.mode;
                
                const modes = {
                    basic: 'üî∞ BASIC: Local database only, fast scanning',
                    advanced: '‚ö° ADVANCED: +YouTube API, redirect following',
                    expert: 'üíÄ EXPERT: +Pattern matching, heuristic analysis',
                    ninja: 'ü•∑ NINJA: +Stealth mode, deep web scanning',
                    quantum: '‚öõÔ∏è QUANTUM: +AI prediction, probabilistic analysis'
                };
                
                elements.modeDesc.textContent = modes[currentMode] || 'BETA MODE';
            });
        });
        
        // Tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentTab = tab.dataset.tab;
                
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(`tab-${currentTab}`).classList.remove('hidden');
            });
        });
        
        // ============================================
        // CHECK BUTTON (med redirect-simulering)
        // ============================================
        elements.checkBtn.addEventListener('click', async () => {
            const input = elements.urlInput.value.trim();
            if (!input) return;
            
            // Fjern gammel YouTube preview
            elements.youtubePreview.innerHTML = '';
            
            updateResult('üîç', 'SCANNING...', 'Analyzing input', '', 0);
            
            // SJEKK 1: Redirect (hvis avkrysset)
            let finalUrl = input;
            const followRedirects = document.getElementById('followRedirects').checked;
            
            if (followRedirects) {
                const redirect = simulateRedirect(input);
                if (redirect.redirected) {
                    updateResult('üîÑ', 'REDIRECT DETECTED', `Following to: ${redirect.destination}`, '', 30);
                    finalUrl = redirect.destination;
                    await new Promise(r => setTimeout(r, 1000)); // Simuler venting
                }
            }
            
            // SJEKK 2: YouTube scan
            if (finalUrl.includes('youtube.com') || finalUrl.includes('youtu.be')) {
                const youtubeData = await scanYouTube(finalUrl);
                
                if (youtubeData) {
                    let result = { 
                        isRickroll: youtubeData.confidence >= 50, 
                        confidence: youtubeData.confidence,
                        reason: youtubeData.findings.join(', ')
                    };
                    
                    updateResult(
                        result.isRickroll ? 'üö®' : '‚úÖ',
                        result.isRickroll ? 'RICKROLL DETECTED' : 'SAFE',
                        `YouTube: ${youtubeData.title.substring(0, 50)}...`,
                        youtubeData.findings.map(f => `‚Ä¢ ${f}`).join('<br>'),
                        youtubeData.confidence
                    );
                    
                    // VIS YOUTUBE PREVIEW med "SE VIDEO" knapp!
                    showYouTubePreview(youtubeData);
                    
                    addToHistory(`YouTube: ${youtubeData.title.substring(0, 30)}...`, result);
                    return;
                }
            }
            
            // SJEKK 3: Standard URL check
            const result = checkUrl(finalUrl);
            updateResult(
                result.isRickroll ? 'üö®' : '‚úÖ',
                result.isRickroll ? 'RICKROLL DETECTED' : 'SAFE',
                result.reason || 'No threats detected',
                '',
                result.confidence
            );
            addToHistory(input, result);
        });
        
        // ============================================
        // DEEP SCAN (med mer detaljer)
        // ============================================
        elements.deepScanBtn.addEventListener('click', async () => {
            const input = elements.urlInput.value.trim();
            if (!input) return;
            
            updateResult('üî¨', 'DEEP SCAN', 'Running advanced analysis...', '', 20);
            
            // Deep scan simulerer mer grundig sjekk
            setTimeout(async () => {
                // Sjekk YouTube med dyp analyse
                if (input.includes('youtube.com') || input.includes('youtu.be')) {
                    const youtubeData = await scanYouTube(input);
                    if (youtubeData) {
                        // Legg til ekstra "deep" funn
                        youtubeData.confidence = Math.min(youtubeData.confidence + 15, 100);
                        youtubeData.findings.push('üî¨ Deep scan: Checked comments section');
                        youtubeData.findings.push('üî¨ Deep scan: Analyzed video metadata');
                        
                        updateResult(
                            youtubeData.confidence >= 50 ? 'üö®' : '‚úÖ',
                            youtubeData.confidence >= 50 ? 'RICKROLL DETECTED (DEEP)' : 'SAFE (DEEP)',
                            `Deep scan complete`,
                            youtubeData.findings.map(f => `‚Ä¢ ${f}`).join('<br>'),
                            youtubeData.confidence
                        );
                        
                        showYouTubePreview(youtubeData);
                        return;
                    }
                }
                
                const result = checkUrl(input);
                result.confidence = Math.min(result.confidence + 20, 100);
                result.reason = 'Deep scan: ' + (result.reason || 'No threats') + ' + heuristic analysis';
                
                updateResult(
                    result.isRickroll ? 'üö®' : '‚úÖ',
                    result.isRickroll ? 'RICKROLL DETECTED (DEEP)' : 'SAFE (DEEP)',
                    'Deep scan completed - extra patterns checked',
                    '‚Ä¢ Heuristic analysis performed<br>‚Ä¢ Pattern matching depth: HIGH<br>‚Ä¢ Suspicious word count: ' + Math.floor(Math.random() * 5),
                    result.confidence
                );
            }, 2000);
        });
        
        // ============================================
        // TEST BUTTON
        // ============================================
        elements.testBtn.addEventListener('click', () => {
            const tests = [
                'https://youtu.be/dQw4w9WgXcQ',
                'https://youtube.com/shorts/dQw4w9WgXcQ',
                'https://rickroll.it',
                'https://bit.ly/3t0x1mz',
                'https://safe-site.com',
                'free-robux-generator.com'
            ];
            elements.urlInput.value = tests[Math.floor(Math.random() * tests.length)];
            elements.checkBtn.click();
        });
        
        // ============================================
        // CLEAR HISTORY
        // ============================================
        elements.clearBtn.addEventListener('click', () => {
            if (confirm('Clear all history?')) {
                history = [];
                updateHistory();
                updateResult('üóëÔ∏è', 'HISTORY CLEARED', 'All scan history removed', '', 0);
            }
        });
        
        // ============================================
        // TEXT ANALYSIS
        // ============================================
        elements.analyzeTextBtn.addEventListener('click', () => {
            const text = elements.textInput.value.trim();
            if (!text) return;
            
            const results = analyzeText(text);
            
            if (results.length === 0) {
                updateResult('‚úÖ', 'CLEAN TEXT', 'No threats found', '', 0);
            } else {
                let details = results.map(r => 
                    `‚Ä¢ ${r.type}: "${r.match}" (${r.confidence}%) ${r.count ? 'x' + r.count : ''}`
                ).join('<br>');
                
                let maxConfidence = Math.max(...results.map(r => r.confidence));
                updateResult('‚ö†Ô∏è', 'THREATS FOUND', `${results.length} suspicious items detected`, details, maxConfidence);
            }
        });
        
        // ============================================
        // EXTRACT URLS
        // ============================================
        elements.extractUrlsBtn.addEventListener('click', () => {
            const text = elements.textInput.value.trim();
            if (!text) return;
            
            const urls = text.match(/https?:\/\/[^\s]+/gi) || [];
            if (urls.length === 0) {
                updateResult('üîó', 'NO URLS', 'No URLs found in text', '', 0);
            } else {
                let details = urls.map(url => `‚Ä¢ <a href="${url}" target="_blank" style="color:#00ff00;">${url.substring(0, 50)}...</a>`).join('<br>');
                updateResult('üîó', `${urls.length} URLS FOUND`, 'Click to open', details, 0);
            }
        });
        
        // ============================================
        // FIND PATTERNS
        // ============================================
        elements.findPatternsBtn.addEventListener('click', () => {
            const text = elements.textInput.value.trim();
            if (!text) return;
            
            let matches = [];
            KEYWORDS.patterns.forEach(pattern => {
                const found = text.match(pattern);
                if (found) matches.push(found[0]);
            });
            
            if (matches.length === 0) {
                updateResult('üîç', 'NO PATTERNS', 'No matching patterns found', '', 0);
            } else {
                updateResult('üîç', 'PATTERNS FOUND', `${matches.length} patterns detected`, matches.join('<br>'), 70);
            }
        });
        
        // ============================================
        // BATCH CHECK
        // ============================================
        elements.batchCheckBtn.addEventListener('click', () => {
            const text = elements.batchInput.value.trim();
            if (!text) return;
            
            const lines = text.split('\n').filter(l => l.trim());
            let rickrollCount = 0;
            let results = [];
            
            lines.forEach(line => {
                const result = checkUrl(line);
                if (result.isRickroll) rickrollCount++;
                results.push({
                    url: line.substring(0, 30) + '...',
                    isRickroll: result.isRickroll,
                    confidence: result.confidence
                });
            });
            
            elements.batchTotal.textContent = lines.length;
            elements.batchRickrolls.textContent = rickrollCount;
            
            // Vis resultater i egen div
            let html = '<h4>Batch Results:</h4>';
            results.forEach(r => {
                html += `<div style="border-bottom: 1px solid #333; padding: 5px;">
                    <span style="color: ${r.isRickroll ? '#ff6666' : '#00ff00'}">${r.isRickroll ? 'üö®' : '‚úÖ'}</span> 
                    ${r.url} [${r.confidence}%]
                </div>`;
            });
            
            // Lagre i en egen div (vi m√• lage den)
            let batchDiv = document.getElementById('batchResults');
            if (!batchDiv) {
                batchDiv = document.createElement('div');
                batchDiv.id = 'batchResults';
                batchDiv.style.marginTop = '15px';
                document.getElementById('tab-batch').appendChild(batchDiv);
            }
            batchDiv.innerHTML = html;
        });
        
        // ============================================
        // EXPORT CSV
        // ============================================
        elements.exportCsvBtn.addEventListener('click', () => {
            const text = elements.batchInput.value.trim();
            if (!text) return;
            
            const lines = text.split('\n').filter(l => l.trim());
            let csv = 'URL,Status,Confidence,Timestamp\n';
            const now = new Date().toISOString();
            
            lines.forEach(line => {
                const result = checkUrl(line);
                csv += `"${line.replace(/"/g, '""')}",${result.isRickroll ? 'RICKROLL' : 'SAFE'},${result.confidence},${now}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rickroll-scan-${new Date().toISOString().slice(0,10)}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        });
        
        // ============================================
        // IMPORT LIST
        // ============================================
        elements.importListBtn.addEventListener('click', () => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt,.csv';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    elements.batchInput.value = event.target.result;
                };
                reader.readAsText(file);
            };
            input.click();
        });
        
        // ============================================
        // API FUNCTIONS (placeholder)
        // ============================================
        elements.testApiBtn.addEventListener('click', () => {
            const service = elements.apiService.value;
            const key = elements.apiKey.value;
            
            if (service === 'none') {
                alert('No API selected');
                return;
            }
            
            updateResult('üß™', 'TESTING API', `Testing ${service} connection...`, '', 50);
            
            setTimeout(() => {
                updateResult('‚úÖ', 'API TEST COMPLETE', `${service} connection successful`, 'API Quota: 30% remaining', 0);
            }, 1500);
        });
        
        elements.saveApiBtn.addEventListener('click', () => {
            localStorage.setItem('apiKey', elements.apiKey.value);
            localStorage.setItem('apiService', elements.apiService.value);
            alert('API settings saved to localStorage');
        });
        
        // ============================================
        // DATABASE MANAGEMENT
        // ============================================
        elements.saveDbBtn.addEventListener('click', () => {
            const text = elements.dbEditor.value.trim();
            const lines = text.split('\n').filter(l => l.trim());
            if (lines.length > 0) {
                database = [...new Set([...database, ...lines])];
                updateStats();
                updateResult('üíæ', 'DATABASE UPDATED', `${database.length} patterns total`, '', 0);
            }
        });
        
        elements.resetDbBtn.addEventListener('click', () => {
            if (confirm('Reset to default database?')) {
                database = [...DEFAULT_DB];
                elements.dbEditor.value = database.join('\n');
                updateStats();
                updateResult('üîÑ', 'DATABASE RESET', 'Default patterns restored', '', 0);
            }
        });
        
        elements.exportDbBtn.addEventListener('click', () => {
            const data = {
                database: database,
                exported: new Date().toISOString(),
                count: database.length
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rickroll-db-${new Date().toISOString().slice(0,10)}.json`;
            a.click();
        });
        
        elements.importDbBtn.addEventListener('click', () => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.database && Array.isArray(data.database)) {
                            database = [...new Set([...database, ...data.database])];
                            elements.dbEditor.value = database.join('\n');
                            updateStats();
                            updateResult('üì•', 'DATABASE IMPORTED', `Added ${data.database.length} patterns`, '', 0);
                        }
                    } catch (err) {
                        alert('Invalid JSON file');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        });
        
        // ============================================
        // INITIAL SETUP
        // ============================================
        elements.patternCount.textContent = database.length;
        elements.dbEditor.value = database.join('\n');
        updateResult('‚ö°', 'PROblock BETA READY', 'Select mode and start scanning', '', 0);
        
        // Load saved API settings
        const savedKey = localStorage.getItem('apiKey');
        const savedService = localStorage.getItem('apiService');
        if (savedKey) elements.apiKey.value = savedKey;
        if (savedService) elements.apiService.value = savedService;
    </script>
</body>
</html>
